# WEB-005-7: Undo/Redo System

## Metadata
- **Status:** ready
- **Type:** feature
- **Epic:** web-forms
- **Priority:** medium
- **Size:** small
- **Estimated Effort:** 1-2 days
- **Created:** 2025-09-30
- **Parent Task:** WEB-005 (archived - oversized)
- **Branch:** feat/WEB-005-7-undo-redo-system

## Description
Implement undo/redo functionality for form designer actions, allowing users to revert and replay changes to the form schema. This includes keyboard shortcuts (Ctrl+Z, Ctrl+Y) and UI controls, with a history state management system.

## Acceptance Criteria
- [ ] Implement history state management
- [ ] Add undo functionality (Ctrl+Z / Cmd+Z)
- [ ] Add redo functionality (Ctrl+Y / Cmd+Y)
- [ ] Show undo/redo buttons in designer header with enabled states
- [ ] Limit history to reasonable size (e.g., 50 actions)

## Technical Notes
- Capture schema snapshots on significant changes
- Don't capture every keystroke (debounce text input changes)
- Clear redo stack when new action occurs
- Use keyboard event handling for shortcuts
- Show disabled state when undo/redo not available

## Implementation Approach
```typescript
const useFormHistory = (initialSchema: FormSchema) => {
  const [history, setHistory] = useState<FormSchema[]>([initialSchema]);
  const [currentIndex, setCurrentIndex] = useState(0);
  const MAX_HISTORY = 50;

  const pushToHistory = useCallback((schema: FormSchema) => {
    // Remove any redo states
    const newHistory = history.slice(0, currentIndex + 1);
    newHistory.push(schema);

    // Limit history size
    if (newHistory.length > MAX_HISTORY) {
      newHistory.shift();
    } else {
      setCurrentIndex(prev => prev + 1);
    }

    setHistory(newHistory);
  }, [history, currentIndex]);

  const undo = useCallback(() => {
    if (currentIndex > 0) {
      setCurrentIndex(prev => prev - 1);
      return history[currentIndex - 1];
    }
    return null;
  }, [currentIndex, history]);

  const redo = useCallback(() => {
    if (currentIndex < history.length - 1) {
      setCurrentIndex(prev => prev + 1);
      return history[currentIndex + 1];
    }
    return null;
  }, [currentIndex, history]);

  return {
    currentSchema: history[currentIndex],
    pushToHistory,
    undo,
    redo,
    canUndo: currentIndex > 0,
    canRedo: currentIndex < history.length - 1
  };
};
```

## Dependencies
- WEB-005-1: Form Designer Foundation (state management integration)

## Follows After
- WEB-005-3: Form Canvas and Field Management (actions to undo)

## Enables
- Better user experience for form editing
- Recovery from mistakes

## Testing Strategy
- Unit tests for history management logic
- Test undo reverts changes correctly
- Test redo replays changes correctly
- Verify keyboard shortcuts work
- Test history limit enforcement
- Verify redo stack clears on new action

## Success Metrics
- Undo reverts to previous schema state
- Redo restores undone changes
- Keyboard shortcuts function correctly
- History limit prevents memory issues
- UI buttons show correct enabled/disabled states

## Branch Naming
`feat/WEB-005-7-undo-redo-system`
# WEB-007-7: Security Settings and Auth Methods

## Metadata
- **Status:** ready
- **Type:** feature
- **Epic:** web-auth
- **Priority:** medium
- **Size:** medium
- **Estimated Effort:** 3-5 days
- **Created:** 2025-09-30
- **Parent Task:** WEB-007 (archived - oversized)
- **Branch:** feat/WEB-007-7-security-settings-auth-methods

## Description
Implement the security settings tab within account management where users can manage their authentication methods (add/remove passkeys, magic link, passwords), set a primary method, and manage trusted devices.

## Acceptance Criteria
- [ ] Create security settings tab interface
- [ ] Display list of user's authentication methods
- [ ] Implement add authentication method flow
- [ ] Support removing authentication methods
- [ ] Add trusted devices management

## Technical Notes
- Users must have at least one auth method
- Primary method used for default login
- Each auth method shows when it was added and last used
- Trusted devices show device info and location

## Implementation Approach
```typescript
const SecuritySettings = () => {
  const { data: authMethods } = useQuery({
    queryKey: ['user-auth-methods'],
    queryFn: () => apiClient.auth.getUserAuthMethods()
  });

  const removeMethod = async (methodId: string) => {
    if (authMethods.length <= 1) {
      throw new Error('Cannot remove last authentication method');
    }
    await apiClient.auth.removeAuthMethod(methodId);
  };

  return (
    <div className="security-settings">
      <div className="auth-methods-section">
        <h3>Authentication Methods</h3>
        <p>You can sign in using any of these methods</p>

        {authMethods?.map(method => (
          <Card key={method.id} className="auth-method-card">
            <CardContent>
              <div className="method-info">
                <MethodIcon type={method.type} />
                <div>
                  <h4>{getMethodName(method.type)}</h4>
                  <p>Added {formatDate(method.createdAt)}</p>
                  <p>Last used {formatDate(method.lastUsedAt)}</p>
                </div>
              </div>

              <div className="method-actions">
                {method.isPrimary && <Badge>Primary</Badge>}
                {!method.isPrimary && (
                  <Button
                    variant="outline"
                    size="sm"
                    onClick={() => setPrimaryMethod(method.id)}
                  >
                    Set as Primary
                  </Button>
                )}
                <Button
                  variant="ghost"
                  size="sm"
                  onClick={() => removeMethod(method.id)}
                  disabled={authMethods.length <= 1}
                >
                  Remove
                </Button>
              </div>
            </CardContent>
          </Card>
        ))}

        <Button onClick={() => openAddMethodDialog()}>
          Add Authentication Method
        </Button>
      </div>

      <div className="trusted-devices-section">
        <h3>Trusted Devices</h3>
        <TrustedDevicesList />
      </div>
    </div>
  );
};
```

## Dependencies
- WEB-007-6: Account Management Interface (security tab)
- WEB-007-3: Passkey Flow (for adding passkeys)
- WEB-007-4: Magic Link Flow (for adding magic link)
- WEB-007-5: Password Flow (for adding password)

## Follows After
- WEB-007-6: Account Management Interface

## Enables
- Complete authentication method management

## Testing Strategy
- Unit tests for method list display
- Test add/remove method flows
- Verify primary method setting
- Test trusted devices list

## Success Metrics
- Auth methods display correctly
- Users can add new methods
- Users can remove methods (except last one)
- Primary method can be changed
- Trusted devices list shows correctly

## Branch Naming
`feat/WEB-007-7-security-settings-auth-methods`
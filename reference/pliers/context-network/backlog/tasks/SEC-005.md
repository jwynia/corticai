# SEC-005: Fix ReDoS Vulnerability in Event Type Validation

## Metadata
- **Status:** completed
- **Type:** security
- **Epic:** security-hardening
- **Priority:** critical
- **Size:** small
- **Created:** 2025-09-24
- **Branch:** task/SEC-005-redos-fix

## Description
The WebSocket authentication module contains a potential ReDoS (Regular Expression Denial of Service) vulnerability in the event type pattern validation. The current regex `/^[a-zA-Z0-9_\.\*]+$/` could cause exponential backtracking on malicious input.

## Acceptance Criteria
- [ ] Replace vulnerable regex `/^[a-zA-Z0-9_\.\*]+$/` with safe validation
- [ ] Add maximum length check (e.g., 256 chars) before any pattern matching
- [ ] Implement character-by-character validation or use a simpler, non-backtracking pattern
- [ ] Add unit tests with known ReDoS patterns (e.g., 'a' * 10000 + '!')
- [ ] Benchmark validation performance (must handle 10,000 validations/sec)
- [ ] Document the new validation approach in code comments

## Technical Notes
- Location: `src/lib/event-engine/websocket-auth.ts:266,470`
- Current pattern: `/^[a-zA-Z0-9_\.\*]+$/`
- Consider character-by-character validation or simpler patterns
- Ensure validation remains strict for security

## Dependencies
- SEC-004: WebSocket Authentication (completed)

## Security Impact
- **Current Risk:** HIGH - Potential DoS attack vector
- **Post-Fix Risk:** LOW - Properly validated input

## Testing Strategy
- Unit tests with ReDoS patterns:
  - Very long strings (10,000+ characters)
  - Strings with alternating valid/invalid characters
  - Known problematic patterns from OWASP
- Performance benchmarks:
  - Measure time for 10,000 validations
  - Compare before/after fix performance
- Validation correctness tests:
  - Valid patterns: 'user.created', 'order.*', 'system_event_123'
  - Invalid patterns: 'user@created', 'order#', strings with spaces
- Edge cases:
  - Empty strings
  - Single character strings
  - Maximum allowed length strings

## References
- Original finding from SEC-004 code review
- OWASP ReDoS prevention guidelines
- Location in code: `src/lib/event-engine/websocket-auth.ts:266,470`

## Implementation Approach
```typescript
// Recommended safe validation approach
function isValidEventType(eventType: string): boolean {
  // Length check first
  if (!eventType || eventType.length > 256) {
    return false;
  }

  // Character-by-character validation (no backtracking)
  const allowedChars = /^[a-zA-Z0-9_.*]$/;
  for (const char of eventType) {
    if (!allowedChars.test(char)) {
      return false;
    }
  }
  return true;
}
```

## Branch Naming
`task/SEC-005-redos-vulnerability-fix`

## Pull Request
- **PR #7**: https://github.com/jwynia/pliers/pull/7
- **Status**: Merged âœ“
- **Created**: 2025-09-25
- **Completed**: 2025-09-25
- **Merged By**: @jwynia